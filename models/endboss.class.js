class Endboss extends MovableObject {
    IMAGES_IDLE = [
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_000.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_001.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_002.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_003.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_004.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_005.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_006.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_007.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_008.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_009.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_010.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_011.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_012.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_013.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_014.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_015.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_016.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Idle/0_Zombie_Villager_Idle_017.png'
    ];

    IMAGES_WALKING = [
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_000.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_001.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_002.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_003.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_004.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_005.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_006.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_007.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_008.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_009.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_010.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_011.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_012.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_013.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_014.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_015.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_016.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_017.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_018.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_019.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_020.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_021.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_022.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Walking/0_Zombie_Villager_Walking_023.png'
    ];

    IMAGES_DYING = [
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_000.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_001.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_002.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_003.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_004.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_005.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_006.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_007.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_008.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_009.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_010.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_011.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_012.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_013.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_014.png'
    ];

    IMAGES_AGGRO = [
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Slashing/0_Zombie_Villager_Slashing_000.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Slashing/0_Zombie_Villager_Slashing_001.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Slashing/0_Zombie_Villager_Slashing_002.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Slashing/0_Zombie_Villager_Slashing_003.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Slashing/0_Zombie_Villager_Slashing_004.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Slashing/0_Zombie_Villager_Slashing_005.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Slashing/0_Zombie_Villager_Slashing_006.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Slashing/0_Zombie_Villager_Slashing_007.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Slashing/0_Zombie_Villager_Slashing_008.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Slashing/0_Zombie_Villager_Slashing_009.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Slashing/0_Zombie_Villager_Slashing_010.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Slashing/0_Zombie_Villager_Slashing_011.png'
    ];

    IMAGES_HURTING = [
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_000.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_001.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_002.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_001.png',
        'img/zombie/Zombie_Villager_3/PNG/PNG Sequences/Dying/0_Zombie_Villager_Dying_000.png'
    ];

    world;
    positionX = 3300;
    positionY = -50;
    otherDirection = true;
    width = 450;
    height = 450;
    distance;
    goesBack = false;
    aggroActivated = false;
    hurt = false;
    hurtSound = new Audio('audio/boss-hurt.mp3');
    dyingSound = new Audio('audio/boss-dying.mp3');
    aggroSound = new Audio('audio/endboss-aggro.mp3');

    constructor() {
        super().loadImg(this.IMAGES_IDLE[0]);
        this.loadImages(this.IMAGES_IDLE);
        this.loadImages(this.IMAGES_WALKING);
        this.loadImages(this.IMAGES_DYING);
        this.loadImages(this.IMAGES_AGGRO);
        this.loadImages(this.IMAGES_HURTING);

        this.animate();
    }

    animate() {
        setInterval(() => {
            this.distanceBetweenCharacterAndEndboss();
            this.endbossIdle();
            this.endbossAggro();
            this.endbossMoving();
            this.endbossGetsHurt();
        }, 1000 / 20);

        let deathInterval = setInterval(() => {
            this.endbossDies(deathInterval);
        }, 1000 / 20);
    }

    distanceBetweenCharacterAndEndboss() {
        if (this.world && this.world.character) {
            this.distance = this.world.calculateDistance();
        }
    }

    endbossIdle() {
        if (this.distance >= 280 && !this.aggroActivated) {
            this.animateImages(this.IMAGES_IDLE);
        }
    }

    endbossAggro() {
        if (this.distance <= 280 && !this.aggroActivated) {
            this.animateImages(this.IMAGES_AGGRO);
            this.aggroSound.play();
            setTimeout(() => {
                this.aggroActivated = true;
            }, this.IMAGES_AGGRO.length * 200);
        }
    }

    endbossMoving() {
        this.endbossMovesLeft();
        this.endbossMovesRight();
    }

    endbossMovesLeft() {
        if (!this.goesBack && this.distance <= 360 && this.aggroActivated && !this.dead()) {
            this.animateImages(this.IMAGES_WALKING);
            this.speedX = 20;
            this.moveLeft();
            if (this.positionX <= 2800) {
                this.goesBack = true;
            }

            if (!this.world.character.dead()) {
                this.aggroSound.play();
            }
        }
    }

    endbossMovesRight() {
        if (this.goesBack && !this.dead()) {
            this.animateImages(this.IMAGES_WALKING);
            this.speedX = 6;
            this.moveRight();
            if (this.positionX >= 3300) {
                this.goesBack = false;
            }
        }
    }

    endbossGetsHurt() {
        if (this.hurtButNotDead()) {
            this.animateImages(this.IMAGES_HURTING);
            this.hurtSound.play();
            setTimeout(() => {
                this.hurt = true;
            }, this.IMAGES_HURTING.length);
        }
    }

    endbossDies(deathInterval) {
        if (this.dead()) {
            this.animateImages(this.IMAGES_DYING);
            this.dyingSound.play();
            if (this.currentImg == this.IMAGES_DYING.length) {
                clearInterval(deathInterval);
            }
            setTimeout(() => {
                gameOverWin();
            }, 2000);
        }
    }
}
